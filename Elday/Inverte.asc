Version 4
SHEET 1 5032 720
WIRE 576 -976 16 -976
WIRE 1168 -976 576 -976
WIRE 1744 -976 1168 -976
WIRE 576 -800 576 -976
WIRE 1168 -800 1168 -976
WIRE 1744 -800 1744 -976
WIRE 16 -736 16 -976
WIRE 528 -720 496 -720
WIRE 1120 -720 1088 -720
WIRE 1664 -720 1664 -736
WIRE 1696 -720 1664 -720
WIRE 576 -608 576 -704
WIRE 2176 -608 576 -608
WIRE 2368 -608 2256 -608
WIRE 2528 -608 2448 -608
WIRE 2720 -608 2560 -608
WIRE 2784 -608 2720 -608
WIRE 2544 -592 2496 -592
WIRE 16 -496 16 -656
WIRE 192 -496 16 -496
WIRE 1168 -496 1168 -704
WIRE 2176 -496 1168 -496
WIRE 2368 -496 2256 -496
WIRE 2528 -496 2448 -496
WIRE 2720 -496 2560 -496
WIRE 2784 -496 2720 -496
WIRE 2864 -496 2864 -608
WIRE 2608 -480 2544 -480
WIRE 192 -432 192 -496
WIRE 1744 -400 1744 -704
WIRE 2176 -400 1744 -400
WIRE 2368 -400 2256 -400
WIRE 2528 -400 2448 -400
WIRE 2720 -400 2560 -400
WIRE 2784 -400 2720 -400
WIRE 2864 -400 2864 -496
WIRE 576 -304 576 -608
WIRE 1168 -304 1168 -496
WIRE 1744 -304 1744 -400
WIRE 2496 -304 2496 -592
WIRE 2544 -304 2544 -384
WIRE 2608 -304 2608 -480
WIRE 16 -240 16 -496
WIRE 528 -224 496 -224
WIRE 1120 -224 1056 -224
WIRE 1696 -224 1664 -224
WIRE 16 -48 16 -160
WIRE 576 -48 576 -208
WIRE 576 -48 16 -48
WIRE 1168 -48 1168 -208
WIRE 1168 -48 576 -48
WIRE 1744 -48 1744 -208
WIRE 1744 -48 1168 -48
WIRE -16 112 -64 112
WIRE 688 112 608 112
WIRE 1184 128 976 128
WIRE 1536 128 1488 128
WIRE -16 144 -64 144
WIRE 688 144 528 144
WIRE 1488 144 1488 128
WIRE 1488 144 1248 144
WIRE 1776 144 1600 144
WIRE 1184 160 1088 160
WIRE 1536 160 1504 160
WIRE -16 176 -64 176
WIRE 192 176 144 176
WIRE 2464 224 2400 224
WIRE 608 240 608 112
WIRE 608 240 544 240
WIRE 688 240 608 240
WIRE 1104 240 752 240
WIRE 1504 240 1504 160
WIRE 2240 240 2192 240
WIRE -16 256 -64 256
WIRE 2080 256 2000 256
WIRE 2192 256 2192 240
WIRE 2192 256 2144 256
WIRE 2464 256 2400 256
WIRE -16 288 -64 288
WIRE 176 288 112 288
WIRE 1776 304 1776 144
WIRE 1840 304 1776 304
WIRE 2000 304 2000 256
WIRE 2000 304 1968 304
WIRE -16 320 -64 320
WIRE 176 320 112 320
WIRE 2464 320 2400 320
WIRE 1840 336 1776 336
WIRE 2080 336 1968 336
WIRE 2240 336 2144 336
WIRE -16 352 -64 352
WIRE 2464 352 2400 352
WIRE 1840 368 1792 368
WIRE 2000 368 1968 368
WIRE 2000 416 2000 368
WIRE 2080 416 2000 416
WIRE 2192 416 2144 416
WIRE 2464 416 2400 416
WIRE -16 432 -64 432
WIRE 1792 432 1792 368
WIRE 1840 432 1792 432
WIRE 2192 432 2192 416
WIRE 2240 432 2192 432
WIRE 2464 448 2400 448
WIRE -16 464 -64 464
WIRE 192 464 112 464
WIRE 608 480 560 480
WIRE 688 480 608 480
WIRE 1088 480 1088 160
WIRE 1088 480 752 480
WIRE -16 496 -64 496
WIRE 192 496 112 496
WIRE -16 528 -64 528
WIRE 1104 560 1104 240
WIRE 1200 560 1104 560
WIRE 1504 560 1504 512
WIRE 1552 560 1504 560
WIRE 608 576 608 480
WIRE 688 576 608 576
WIRE 1488 576 1264 576
WIRE 1776 576 1776 336
WIRE 1776 576 1616 576
WIRE 1200 592 976 592
WIRE 1488 592 1488 576
WIRE 1552 592 1488 592
WIRE 688 608 544 608
FLAG 544 240 id
FLAG 560 480 iq
FLAG 1504 240 vgd
FLAG 1504 512 vgq
FLAG 1840 432 theta
FLAG 2464 224 G2
FLAG 2464 256 G1
FLAG 2464 320 G4
FLAG 2464 352 G3
FLAG 2464 448 G5
FLAG 2464 416 G6
FLAG 192 176 theta
FLAG -64 352 theta
FLAG -64 112 vga
FLAG -64 144 vgb
FLAG -64 176 vgc
FLAG -64 432 vga
FLAG -64 464 vgb
FLAG -64 496 vgc
FLAG -64 256 ia
FLAG -64 288 ib
FLAG -64 320 ic
FLAG 176 288 id
FLAG 176 320 iq
FLAG 192 464 vgd
FLAG 192 496 vgq
FLAG 496 -720 G1
FLAG 2496 -304 ia
FLAG 2608 -304 ib
FLAG 2544 -304 ic
FLAG 2720 -608 vga
FLAG 2720 -496 vgb
FLAG 2720 -400 vgc
FLAG 2208 -784 G5
FLAG 1664 -736 G5
FLAG 1056 -224 G4
FLAG 1664 -224 G6
FLAG 496 -224 G2
FLAG -64 528 theta
FLAG 1088 -720 G3
FLAG 192 -432 0
SYMBOL PLL2 48 144 R0
SYMATTR InstName X2
SYMBOL abctodq3 48 304 R0
SYMATTR InstName X1
SYMBOL abctodq3 48 480 R0
SYMATTR InstName X3
SYMBOL PI_Controller 768 128 R0
SYMATTR InstName X4
SYMBOL PI_Controller 768 592 R0
SYMATTR InstName X5
SYMBOL subtractor 1216 144 R0
SYMATTR InstName X6
SYMBOL adder 1232 576 R0
SYMATTR InstName X7
SYMBOL adder 1568 144 R0
SYMATTR InstName X8
SYMBOL adder 1584 576 R0
SYMATTR InstName X9
SYMBOL dqtoabc 1904 336 R0
SYMATTR InstName X10
SYMBOL Gain 720 240 R0
SYMATTR InstName X11
SYMBOL Gain 720 480 R0
SYMATTR InstName X12
SYMBOL Gain 2112 336 R0
SYMATTR InstName X13
SYMBOL Gain 2112 256 R0
SYMATTR InstName X14
SYMBOL Gain 2112 416 R0
SYMATTR InstName X15
SYMBOL pwm 2320 240 R0
SYMATTR InstName X18
SYMBOL pwm 2320 336 R0
SYMATTR InstName X19
SYMBOL pwm 2320 432 R0
SYMATTR InstName X20
SYMBOL voltage 16 -752 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 100
SYMBOL voltage 16 -256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 100
SYMBOL res 2272 -624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL res 2272 -512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL res 2272 -416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL ind 2352 -592 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 2m
SYMBOL ind 2352 -480 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 2m
SYMBOL ind 2352 -384 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value 2m
SYMBOL res 2880 -624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1
SYMBOL res 2880 -512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName 1
SYMATTR Value 1
SYMBOL res 2880 -416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1
SYMBOL isense 2544 -608 R0
SYMATTR InstName U1
SYMBOL isense 2544 -496 R0
SYMATTR InstName U2
SYMBOL isense 2544 -400 R0
SYMATTR InstName U3
SYMBOL step 496 144 R0
SYMATTR InstName U4
SYMBOL step 512 608 R0
SYMATTR InstName U5
SYMBOL nmos 528 -800 R0
SYMATTR InstName M1
SYMATTR Value STW11NM80
SYMBOL nmos 528 -304 R0
SYMATTR InstName M2
SYMATTR Value STW11NM80
SYMBOL nmos 1120 -304 R0
SYMATTR InstName M3
SYMATTR Value STW11NM80
SYMBOL nmos 1120 -800 R0
SYMATTR InstName M4
SYMATTR Value STW11NM80
SYMBOL nmos 1696 -800 R0
SYMATTR InstName M5
SYMATTR Value STW11NM80
SYMBOL nmos 1696 -304 R0
SYMATTR InstName M6
SYMATTR Value STW11NM80
TEXT -8 648 Left 2 !.param td = 40m
TEXT -8 680 Left 2 !.param fs = 100k
TEXT -136 704 Left 2 !.tran 0.1ms
TEXT 2184 -832 Left 2 !.param R=1
TEXT 2184 -800 Left 2 !.param L=2m
TEXT -488 -256 Left 2 !.param thetadeg=30
TEXT -488 -232 Left 2 !.param theta=(thetadeg*pi)/180
TEXT -488 -192 Left 2 !.param is=50\n.param id=is*cos(theta)\n.param iq=id*sin(theta)
TEXT -480 -96 Left 2 !.param K=1
