Version 4
SHEET 1 1496 848
WIRE 208 -208 -96 -208
WIRE 208 -80 208 -208
WIRE 160 -64 128 -64
WIRE 128 -48 128 -64
WIRE -96 -16 -96 -208
WIRE 160 -16 128 -16
WIRE 208 96 208 0
WIRE 336 96 208 96
WIRE 528 96 416 96
WIRE 672 96 528 96
WIRE 672 112 672 96
WIRE 672 144 672 112
WIRE 208 160 208 96
WIRE 528 160 528 96
WIRE -96 272 -96 64
WIRE 208 272 208 224
WIRE 208 272 -96 272
WIRE 528 272 528 224
WIRE 528 272 208 272
WIRE 672 272 672 224
WIRE 672 272 528 272
WIRE -96 304 -96 272
WIRE 32 528 -224 528
WIRE 176 544 96 544
WIRE 208 544 176 544
WIRE 464 544 272 544
WIRE 32 560 -128 560
WIRE 464 560 464 544
WIRE 496 560 464 560
WIRE 1008 560 944 560
WIRE 704 576 560 576
WIRE -224 592 -224 528
WIRE -128 592 -128 560
WIRE 496 592 464 592
WIRE 704 608 672 608
WIRE 944 608 944 560
WIRE 176 640 176 544
WIRE 208 640 176 640
WIRE 336 640 272 640
WIRE 464 640 464 592
WIRE 464 640 400 640
WIRE 672 640 672 608
WIRE -224 704 -224 672
WIRE -128 704 -128 672
WIRE 672 736 672 720
WIRE 944 736 944 688
FLAG -96 304 0
FLAG 672 112 Vcontrolled
FLAG -224 704 0
FLAG 672 736 0
FLAG 704 576 Comp
FLAG 704 608 Tri
FLAG 944 736 0
FLAG 128 -48 0
FLAG 1008 560 PWM
IOPIN 1008 560 Out
FLAG 128 -16 PWM
IOPIN 128 -16 In
FLAG -128 704 0
SYMBOL voltage -96 -32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL ind 320 112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 20µ
SYMBOL res 656 128 R0
SYMATTR InstName R1
SYMATTR Value 40
SYMBOL diode 224 224 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL sw 208 -96 R0
SYMATTR InstName S1
SYMATTR Value Q1
SYMBOL cap 512 160 R0
SYMATTR InstName C1
SYMATTR Value 20µ
SYMBOL Gain 240 544 R0
WINDOW 39 -31 -48 Left 0
SYMATTR InstName X1
SYMATTR SpiceLine K={R2/R1}
SYMBOL Integral 368 640 R0
SYMATTR InstName X2
SYMBOL Gain 240 640 R0
WINDOW 39 -33 -40 Left 0
SYMATTR InstName X3
SYMATTR SpiceLine K={1/(R1*C)}
SYMBOL adder 528 576 R0
SYMATTR InstName X4
SYMBOL bv -128 576 R0
WINDOW 3 24 92 Left 2
SYMATTR InstName B1
SYMATTR Value V=V(Vcontrolled)
SYMBOL subtractor 64 544 R0
SYMATTR InstName X5
SYMBOL voltage 672 624 R0
WINDOW 3 -428 151 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(-10 10 0 {1/(2*Fs)} {1/(2*Fs)} 1n {1/(Fs)})
SYMBOL bv -224 576 R0
WINDOW 3 -130 98 Left 2
SYMATTR InstName B2
SYMATTR Value V={Vout}
SYMBOL bv 944 592 R0
WINDOW 3 -130 98 Left 2
SYMATTR InstName B3
SYMATTR Value V = if(V(Tri)<V(Comp),15,0)
TEXT 1000 32 Left 2 !.tran 10m uic
TEXT 1000 56 Left 2 !.param fsw = 250k
TEXT 1000 80 Left 2 !.param T = 1/fsw
TEXT 1000 104 Left 2 !.param D =0.5
TEXT 1000 128 Left 2 !.param Ton = D*T
TEXT 272 -48 Left 2 !.model Q1 SW(Ron = 0.001 Roff = 1Meg Vt = 0.5)
TEXT 1000 200 Left 2 !.param R1 = 1k\n.param R2 = 2.7k\n.param C = 20n
TEXT 1000 152 Left 2 !.param Fs = 100k
TEXT 1000 176 Left 2 !.param Vout = 4
